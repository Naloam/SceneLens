# SceneLens APK 测试指南

## 📦 APK 构建状态

APK 正在构建中，构建完成后文件位置：
```
scenelens/android/app/build/outputs/apk/release/app-release.apk
```

## 🔧 构建步骤（如需手动构建）

### 方法一：使用 Gradle（推荐）
```bash
cd scenelens/android
.\gradlew.bat assembleRelease
```

### 方法二：使用 Expo
```bash
cd scenelens
npx expo run:android --variant release
```

## 📱 安装 APK 到手机

### 前置条件
1. 在手机上启用"开发者选项"
   - 设置 → 关于手机 → 连续点击"版本号" 7次
2. 启用"USB调试"
   - 设置 → 开发者选项 → USB调试

### 安装方法

#### 方法一：通过 ADB 安装（推荐）
```bash
# 1. 连接手机到电脑（USB线）
# 2. 在电脑上运行：
adb install scenelens/android/app/build/outputs/apk/release/app-release.apk

# 如果提示已安装旧版本，使用 -r 参数覆盖安装：
adb install -r scenelens/android/app/build/outputs/apk/release/app-release.apk
```

#### 方法二：直接传输到手机
1. 将 `app-release.apk` 文件复制到手机存储
2. 在手机上使用文件管理器找到该文件
3. 点击安装（可能需要允许"未知来源"安装）

## 🧪 测试场景和步骤

### 测试前准备

#### 1. 授予必要权限
首次启动应用后，需要授予以下权限：
- ✅ 位置权限（精确位置）
- ✅ 通知权限
- ✅ 使用情况访问权限（用于应用统计）
- ✅ 勿扰模式权限
- ✅ 活动识别权限

#### 2. 配置首选应用
在应用设置中配置你的首选应用：
- 音乐播放器（如：网易云音乐、QQ音乐）
- 乘车码应用（如：支付宝、微信）

---

## 📋 Week 1 MVP 测试场景

### 场景一：通勤场景测试

#### 测试目标
验证应用能够识别通勤场景并推送相应建议

#### 测试步骤

**步骤 1：模拟通勤时间**
- 将手机系统时间设置为工作日早上 8:00（早高峰）
- 或设置为下午 18:00（晚高峰）

**步骤 2：模拟位置（可选）**
- 如果有开发者选项，可以使用"模拟位置"功能
- 设置位置为地铁站或公交站附近

**步骤 3：模拟运动状态**
- 实际测试：拿着手机走动或乘坐交通工具
- 或者：在应用中手动触发场景检测

**步骤 4：验证场景识别**
- 打开 SceneLens 应用
- 查看主屏幕显示的当前场景
- 应该显示：`当前场景: COMMUTE (通勤)`
- 置信度应该 > 0.6

**步骤 5：验证通知推送**
- 等待 2-5 秒
- 应该收到通知："检测到通勤场景"
- 通知内容包含建议的操作：
  - 打开乘车码
  - 播放音乐
  - 开启勿扰模式

**步骤 6：验证一键执行**
- 点击通知上的"一键执行"按钮
- 验证以下操作：
  - ✅ 自动打开支付宝/微信乘车码（或应用首页）
  - ✅ 自动打开音乐播放器
  - ✅ 手机进入勿扰模式

**预期结果**
- ✅ 场景识别准确
- ✅ 通知及时推送
- ✅ 应用能够正常打开
- ✅ 勿扰模式成功开启

---

### 场景二：静默感知引擎测试

#### 测试目标
验证应用能够静默采集各种信号

#### 测试步骤

**步骤 1：查看信号采集**
- 打开应用主屏幕
- 查看"当前信号"部分
- 应该显示：
  - 时间信号：工作日/周末、时段
  - 位置信号：当前位置类型
  - Wi-Fi信号：当前连接的Wi-Fi名称
  - 运动状态：STILL/WALKING/VEHICLE

**步骤 2：验证时间信号**
- 检查显示的时间是否正确
- 检查工作日/周末判断是否准确
- 检查时段（早高峰/晚高峰/其他）是否正确

**步骤 3：验证位置信号**
- 移动到不同位置
- 观察位置信号的变化
- 验证位置权限是否正常工作

**步骤 4：验证Wi-Fi信号**
- 连接到不同的Wi-Fi网络
- 观察Wi-Fi信号的变化
- 断开Wi-Fi，验证应用是否能正常处理

**步骤 5：验证运动状态**
- 保持静止：应显示 STILL
- 走动：应显示 WALKING
- 乘车：应显示 VEHICLE

**预期结果**
- ✅ 所有信号都能正常采集
- ✅ 信号更新及时
- ✅ 没有崩溃或错误

---

### 场景三：应用发现引擎测试

#### 测试目标
验证应用能够发现和分类已安装的应用

#### 测试步骤

**步骤 1：查看已安装应用**
- 进入应用设置页面
- 查看"应用偏好"部分
- 应该显示已安装的应用列表

**步骤 2：验证应用分类**
- 检查音乐播放器类别
  - 应该包含：网易云音乐、QQ音乐、酷狗音乐等
- 检查乘车码类别
  - 应该包含：支付宝、微信等
- 检查其他类别

**步骤 3：设置首选应用**
- 为每个类别选择首选应用
- 保存设置
- 重启应用，验证设置是否保存

**步骤 4：验证使用统计**
- 授予"使用情况访问"权限
- 查看应用使用统计
- 验证是否显示最常用的应用

**预期结果**
- ✅ 应用列表完整
- ✅ 分类准确
- ✅ 首选应用设置生效
- ✅ 使用统计正常

---

### 场景四：规则引擎测试

#### 测试目标
验证规则引擎能够正确匹配和执行规则

#### 测试步骤

**步骤 1：查看规则列表**
- 进入应用设置
- 查看"场景规则"部分
- 应该显示通勤场景规则

**步骤 2：验证规则匹配**
- 模拟通勤场景条件
- 观察规则匹配结果
- 应该显示匹配的规则和评分

**步骤 3：验证规则执行**
- 触发场景识别
- 点击"执行建议"
- 验证所有动作是否执行

**步骤 4：验证降级策略**
- 卸载某个首选应用
- 再次触发场景
- 验证是否能降级到其他应用或提示

**预期结果**
- ✅ 规则匹配准确
- ✅ 动作执行成功
- ✅ 降级策略生效

---

### 场景五：通知管理测试

#### 测试目标
验证通知功能正常工作

#### 测试步骤

**步骤 1：验证通知权限**
- 首次启动时应请求通知权限
- 授予权限后应能正常推送

**步骤 2：验证通知内容**
- 触发场景识别
- 检查通知内容：
  - 标题：场景名称
  - 内容：建议的操作
  - 按钮：一键执行

**步骤 3：验证通知交互**
- 点击通知：应打开应用
- 点击"一键执行"：应执行所有动作
- 滑动关闭通知：应正常关闭

**步骤 4：验证通知频率**
- 同一场景不应频繁推送
- 应有冷却机制（如：1小时内不重复推送）

**预期结果**
- ✅ 通知正常推送
- ✅ 通知内容正确
- ✅ 交互功能正常
- ✅ 频率控制合理

---

## 🐛 常见问题排查

### 问题 1：应用无法安装
**可能原因：**
- 未启用"未知来源"安装
- 签名冲突（已安装旧版本）

**解决方法：**
```bash
# 卸载旧版本
adb uninstall com.che1sy.scenelens

# 重新安装
adb install app-release.apk
```

### 问题 2：权限请求失败
**可能原因：**
- 系统版本不兼容
- 权限被系统限制

**解决方法：**
- 手动在系统设置中授予权限
- 设置 → 应用 → SceneLens → 权限

### 问题 3：场景识别不准确
**可能原因：**
- 信号采集失败
- 权限未授予
- 规则配置问题

**解决方法：**
- 检查所有权限是否已授予
- 查看应用日志
- 手动触发场景检测

### 问题 4：应用无法打开
**可能原因：**
- Deep Link 失败
- 应用未安装
- 包名错误

**解决方法：**
- 检查首选应用是否已安装
- 查看降级策略是否生效
- 检查应用日志

### 问题 5：勿扰模式无法开启
**可能原因：**
- 未授予勿扰模式权限
- 系统版本不支持

**解决方法：**
- 手动授予勿扰模式权限
- 设置 → 应用 → SceneLens → 特殊权限 → 勿扰模式访问

---

## 📊 测试数据记录

### 测试环境
- 手机型号：__________
- Android 版本：__________
- 测试日期：__________
- APK 版本：1.0.0

### 测试结果

| 测试项 | 预期结果 | 实际结果 | 通过/失败 | 备注 |
|--------|----------|----------|-----------|------|
| 应用安装 | 成功安装 | | ☐ | |
| 权限授予 | 所有权限已授予 | | ☐ | |
| 场景识别 | 识别为通勤场景 | | ☐ | |
| 通知推送 | 收到通知 | | ☐ | |
| 应用打开 | 成功打开应用 | | ☐ | |
| 勿扰模式 | 成功开启 | | ☐ | |
| 信号采集 | 所有信号正常 | | ☐ | |
| 应用发现 | 应用列表完整 | | ☐ | |
| 规则匹配 | 规则匹配准确 | | ☐ | |
| 通知交互 | 交互功能正常 | | ☐ | |

---

## 🎯 性能测试

### 启动时间
- 冷启动时间：__________ ms
- 热启动时间：__________ ms

### 内存占用
- 初始内存：__________ MB
- 运行中内存：__________ MB
- 峰值内存：__________ MB

### 电池消耗
- 测试时长：__________ 小时
- 电池消耗：__________ %
- 平均功耗：__________ mAh/h

### 场景识别性能
- 识别延迟：__________ ms
- 准确率：__________ %

---

## 📝 反馈和建议

### 功能反馈
- 哪些功能运行良好？
- 哪些功能需要改进？
- 有什么新功能建议？

### 用户体验反馈
- 界面是否友好？
- 操作是否流畅？
- 通知是否合理？

### Bug 报告
- 遇到的问题：
- 复现步骤：
- 错误信息：

---

## 🔄 下一步计划

完成 Week 1 测试后，Week 2-4 将实现：
- Week 2：用户触发识别 + 预测触发
- Week 3：多场景支持（会议、学习、到家、睡前、出行）
- Week 4：性能优化 + 答辩材料准备

---

## 📞 技术支持

如有问题，请查看：
- 项目文档：`scenelens/SETUP.md`
- 实现总结：`scenelens/IMPLEMENTATION_SUMMARY.md`
- 测试报告：`scenelens/WEEK1_INTEGRATION_TEST_REPORT.md`
